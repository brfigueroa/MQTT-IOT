<html>
  <head>
    <title>MQTT Prueba</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="http://www.hivemq.com/demos/websocket-client/js/mqttws31.js"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-1.10.1.js"></script>
    <script src="/js/config.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/css/bootstrap.css" />
    <script type="text/javascript">
	
		
	 var client = new Messaging.Client("localhost", 8000, "myclientid_" + parseInt(Math.random() * 100, 10));

	 //Gets  called if the websocket/mqtt connection gets disconnected for any reason
	 client.onConnectionLost = function (responseObject) {
	     //Depending on your scenario you could implement a reconnect logic here
	    // alert("connection lost: " + responseObject.errorMessage);
	 };

	 //Gets called whenever you receive a message for your subscriptions
	 client.onMessageArrived = function (message) {
	     //Do something with the push message you received
	     $('#messages').append('<span>Topic: ' + message.destinationName + '  | ' + message.payloadString + '</span><br/>');
	     	var json = JSON.parse(message.payloadString);
            var ad = json["device"].id;
            var ad1 = json["device"].luz;
            var ad2 = json["device"].sonido;
            
            document.getElementById('numberMsg').innerHTML = ad;
            document.getElementById('numberMsg1').innerHTML = ad1;
            document.getElementById('numberMsg2').innerHTML = ad2;
	 };

	 //Connect Options
	 var options = {
	     timeout: 3,
	     //Gets Called if the connection has sucessfully been established
	     onSuccess: function () {
	   //      alert("Connected");
	     },
	     //Gets Called if the connection could not be established
	     onFailure: function (message) {
	     //    alert("Connection failed: " + message.errorMessage);
	     }
	 };

	 //Creates a new Messaging.Message Object and sends it to the HiveMQ MQTT Broker
	 var publish = function (payload, topic, qos) {
	     //Send your message (also possible to serialize it as JSON or protobuf or just use a string, no limitations)
	     var message = new Messaging.Message(payload);
	     message.destinationName = topic;
	     message.qos = qos;
	     client.send(message);
	 }
	//]]>  

    </script>
    

  </head>
  <body >
	
    <table border="0" cellpadding="10">
      <tr>
        <td>
        	
          <img align=center src="img/mqttorg.png" border=0>
        	
        </td>
      </tr>
      <tr>
      	<td>
          <h1>MQTT Sensors UTPL</h1>
        </td>
      </tr>
    </table>
    <input type="text" name="voto" id="voto" />
    <button onclick="client.connect();">Conectar Websockets</button>
	<button onclick="client.subscribe("javascript:document.getElementById('voto')", {qos: 0})">Subscribirse Topico</button>
	<button onclick="client.unsubscribe("utpl/#")">Desuscribirse Topico</button>
	<button onclick="publish('OFF','utpl/IntelGalileo/led',0);">Publicar Topico</button>
	<button onclick="client.disconnect();">Desconectarse Websockets</button>
	
	<table class="tablegv" style="width: 500px;">
	    <tbody>
	        <tr class="tablegvHeader">
	            <td colspan="2"><center>Valor</center></td>
	</tr>
	<tr>
	    <td>Id</td>
	    <td id="numberMsg"></td>
	</tr>
	<tr>
	    <td>Luz</td>
	    <td id="numberMsg1"></td>
	</tr>

	<tr>
	    <td>Sonido</td>
	    <td id="numberMsg2"></td>
	</tr>

	</tbody>
	</table>
	
  </body>
</html>